(function(){"bind"in Function.prototype||(Function.prototype.bind=function(a){var b=this;if(1>=arguments.length)return function(){return b.apply(a,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){return b.apply(a,0===arguments.length?c:c.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(a,b){void 0===
b&&(b=0);0>b&&(b+=this.length);0>b&&(b=0);for(var c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(a,b){void 0===b&&(b=this.length-1);0>b&&(b+=this.length);b>this.length-1&&(b=this.length-1);for(b++;0<b--;)if(b in this&&this[b]===a)return b;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)c in this&&a.call(b,this[c],c,this)});"map"in Array.prototype||
(Array.prototype.map=function(a,b){for(var c=Array(this.length),d=0,e=this.length;d<e;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c});"filter"in Array.prototype||(Array.prototype.filter=function(a,b){for(var c=[],d,e=0,f=this.length;e<f;e++)e in this&&a.call(b,d=this[e],e,this)&&c.push(d);return c});"every"in Array.prototype||(Array.prototype.every=function(a,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=
function(a,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1})})();
Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),d=c.length;return function(e){if("object"!==typeof e&&("function"!==typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f=[],g;for(g in e)a.call(e,g)&&f.push(g);if(b)for(g=0;g<d;g++)a.call(e,c[g])&&f.push(c[g]);return f}}());var ds=ds||{};ds.array=ds.array||{};ds.object=ds.object||{};ds.data=ds.data||{};ds.make=ds.make||{};ds.str={funct:"function",typeRequired:"The type property is required",type:"type",constructor:"constructor",implementstype:"implementstype",sigNotImplementedIn:"Signature(s) not implemented in ",colon:":",colonspace:": ",newline:"\n"};ds.safe=function(a){try{a()}catch(b){}};
ds.object.get_methods=function(a){var b=[],c;for(c in a)typeof a[c]==ds.str.funct&&(b[c]=c+ds.str.colonspace+a[c].toString());return b};ds.object.get_method_signatures=function(a){var b=[],c;for(c in a)typeof a[c]==ds.str.funct&&b.push(c+ds.str.colonspace+a[c].length);return b};ds.array.diff=function(a,b){return a.filter(function(a){return 0>b.indexOf(a)})};
ds.data.copy=function(a,b,c,d){d||(d=!0);b||(b=a instanceof Array?[]:{});for(var e in a){var f=!0;c&&-1!=c.indexOf(e)&&(f=!1);f&&(d&&!b[e]||!d)&&(b[e]=typeof a[e]==ds.str.funct?a[e]:a[e]==a?a:ds.data.copy(a[e]))}return b};
ds.make["class"]=function(a){if(!a.type)throw ds.str.typeRequired;var b=function(b){var c=b.type;ds.data.copy(b,a,[ds.str.type,ds.str.constructor],!0);return c};if(a.inherits)try{var c;if(a.inherits instanceof Array){c=[];for(var d=0;d<a.inherits.length;d++)c.push(b(a.inherits[d].prototype))}else c=b(a.inherits.prototype);a.inherits=c}catch(e){throw"ERROR: Unable to inherit classes in "+a.type+". Make sure your have created the class with ds.make.class() before attempting to inherit it!";}if(d=a["implements"]){d instanceof
Array||(d=[d]);for(b=0;b<d.length;b++){c=ds.object.get_method_signatures(d[b]);var f=ds.object.get_method_signatures(a);c=ds.array.diff(c,f);if(0<c.length){b=ds.object.get_methods(d[b]);for(d=0;d<c.length;d++)c[d]=b[c[d].substring(0,c[d].indexOf(ds.str.colon))];throw ds.str.sigNotImplementedIn+a.type+ds.str.newline+c.join(ds.str.newline);}}d=Object.keys(d)}a.constructor.prototype=a;return a.constructor};
ds.make["enum"]=function(a){for(var b={},c=Object.keys(a),d=0;d<c.length;d++){var e=a[c[d]];b[c[d]]=e;b[e]=c[d]}return b};ds=ds||{};ds.object=ds.object||{};ds.object.isEqual=function(a,b){if("object"==typeof a&&"object"==typeof b){for(var c in a)if("undefined"==typeof b[c])return!1;for(c in a)if(a[c])switch(typeof a[c]){case "object":if(!ds.object.isEqual(a[c],b[c]))return!1;break;case "function":if("undefined"==typeof b[c]||"equals"!=c&&a[c].toString()!=b[c].toString())return!1;break;default:if(a[c]!=b[c])return!1}else if(b[c])return!1;for(c in b)if("undefined"==typeof a[c])return!1;return!0}return a==b};ds=ds||{};ds.array=ds.array||{};ds.array.diffs=function(a,b){var c=[],d=[],e;for(e=0;e<a.length;e++)c[a[e]]=!0;for(e=0;e<b.length;e++)c[b[e]]?delete c[b[e]]:c[b[e]]=!0;for(e in c)d.push(e);return d};ds.array.where=function(a,b){var c=[],d=0,e;for(e=0;e<a.length;e++)b(a[e])&&(c[d++]=a[e]);return c};
ds.array.select=function(a){var b=[],c=0,d,e;if(2==arguments.length){var f=arguments[1];for(d=0;d<a.length;d++)b[d]=a[d][f]}else for(d=0;d<a.length;d++){var g=a[d],k={};for(e=1;e<arguments.length;e++)f=arguments[e],k[f]=g[f];b[c++]=k}return b};ds=ds||{};ds.get_type=function(a){if(void 0===a)return"[object Undefined]";if(null===a)return"[object Null]";var b=a.__proto__.type;return b?b:Object.prototype.toString.call(a)};ds.type=ds.make["enum"]({Null:"[object Null]",Object:"[object Object]",Array:"[object Array]",Function:"[object Function]"});ds.isNull=function(a){return ds.get_type(a)==ds.type.Null};ds.isArray=function(a){return ds.get_type(a)==ds.type.Array};ds.isObject=function(a){return ds.get_type(a)==ds.type.Object};ds=ds||{};ds.data=ds.data||{};
ds.forx=function(a,b,c){var d=function(a){if(ds.isObject(a)){if(ds.isArray(a[c]))for(var e=0;e<a[c].length;e++)d(a[c][e]);b(a)}},e=function(a,c,d){var f=!0;if(ds.isObject(a))for(var n=Object.keys(a),h=0;h<n.length;h++){var l=a[n[h]];if(ds.isArray(l)&&0<l.length)for(var f=!1,m=0;m<l.length;m++)e(l[m],c++,a)}else if(ds.isArray(a)){for(h=0;h<a.length;h++)e(a[h],c++,a);return}b(a,c,d,f,0===c)},f=function(a){if(!c&&ds.isArray(a.children))if(c="children",ds.isArray(a))for(var f=0;f<a.length;f++)d(a[f],
b);else d(a,b);else e(a,b,0,null)};if("Tree"==ds.get_type(a))f(a.root);else if(ds.isObject(a)||ds.isArray(a))f(a);else throw"forx requires an object or array as input";};ds=ds||{};ds.interfaces=ds.interfaces||{};ds.data=ds.data||{};ds.interfaces.enumerable={toArray:function(){},iterate:function(a){},count:function(){}};ds.interfaces.collection={empty:function(){},at:function(a){},removeAt:function(a){},remove:function(a){}};ds.interfaces.queue={peek:function(){}};ds.data.enumerable=ds.make["class"]({type:"Enumerable",constructor:function(){},toArray:function(){var a=[];this.iterate(function(b){a.push(b)});return a},count:function(){return this.length}});
ds.data.dictionary=ds.make["class"]({type:"Dictionary","implements":[ds.interfaces.enumerable,ds.interfaces.collection],inherits:ds.data.enumerable,constructor:function(a){this.empty();if(a)for(var b=Object.keys(a),c=0;c<b.length;c++){var d=b[c];this.add(d,a[d])}},empty:function(){this.length=0;this.collection={}},add:function(a,b){this.collection[a]=b;return++this.length},at:function(a){return this.collection[a]},removeAt:function(a){if(this.collection[a])return delete this.collection[a],--this.length},
iterate:function(a){for(var b=this.keys(),c=0;c<b.length;c++){var d=b[c];if(d=a(this.collection[d],d))return d}},keys:function(){return Object.keys(this.collection)},remove:function(a){for(var b=this.keys(),c=0;c<b.length;c++){var d=b[c];if(ds.object.isEqual(this.collection[d],a))return this.removeAt(d)}}});
ds.data.list=ds.make["class"]({type:"List","implements":[ds.interfaces.enumerable,ds.interfaces.collection],inherits:ds.data.enumerable,constructor:function(){this.empty();this.addMany.apply(this,arguments)},empty:function(){this.length=0;this.lastnode=this.firstnode=null},iterate:function(a){if(0<this.length)for(var b=this.firstnode,c=0;b&&!a(b.data,c);)c++,b=b.nextnode},addMany:function(){if(arguments)for(var a=0;a<arguments.length;a++)this.add(arguments[a])},add:function(a){var b={};this.lastnode&&
(this.lastnode.nextnode=b);b.prevnode=this.lastnode;b.nextnode=null;b.data=a;this.firstnode||(this.firstnode=b);this.lastnode=b;this.length++},addAt:function(a,b){if(0<=b)if(b>=this.length)this.add(a);else for(var c=this.firstnode,d=0;c;){if(d==b){d=c;c={data:a};c.nextnode=d;c.prevnode=d.prevnode;c.prevnode?c.prevnode.nextnode=c:this.firstnode=c;d.prevnode=c;this.length++;break}d++;c=c.nextnode}},at:function(a){if(0<=a&&a<this.length)for(var b=this.firstnode,c=0;b;){if(c==a)return b.data;c++;b=b.nextnode}},
first:function(){return this.firstnode?this.firstnode.data:null},last:function(){return this.lastnode?this.lastnode.data:null},removeFirst:function(){if(this.firstnode&&this.firstnode.nextnode){var a=this.firstnode.nextnode;a.prevnode=null;this.firstnode=a}},removeLast:function(){if(this.lastnode&&this.lastnode.prevnode){var a=this.lastnode.prevnode;a.nextnode=null;this.lastnode=a}},removeAt:function(a){if(0<=a&&a<this.length)for(var b=this.firstnode,c=0;b;){if(c==a){b.prevnode?b.prevnode.nextnode=
b.nextnode:this.removeFirst();b.nextnode?b.nextnode.prevnode=b.prevnode:this.removeLast();this.length--;break}c++;b=b.nextnode}},remove:function(a){if(0<this.length)for(var b=this.firstnode,c=0;b;){if(ds.object.isEqual(b.data,a))return b.prevnode?b.prevnode.nextnode=b.nextnode:this.removeFirst(),b.nextnode?b.nextnode.prevnode=b.prevnode:this.removeLast(),this.length--,c;c++;b=b.nextnode}return!1},indexOf:function(a){if(0<this.length)for(var b=this.firstnode,c=0;b;){if(ds.object.isEqual(b.data,a))return c;
c++;b=b.nextnode}}});ds.data.stack=ds.make["class"]({type:"Stack","implements":ds.interfaces.queue,inherits:[ds.data.enumerable,ds.data.list],constructor:function(){this.empty();this.addMany.apply(this,arguments)},push:function(a){return this.add(a)},pop:function(){var a=this.lastnode.data;this.removeLast();return a},peek:function(){return this.lastnode.data}});
ds.data.queue=ds.make["class"]({type:"Queue","implements":ds.interfaces.queue,inherits:[ds.data.enumerable,ds.data.list],constructor:function(){this.empty();this.addMany.apply(this,arguments)},enqueue:function(a){return this.add(a)},dequeue:function(){var a=this.firstnode.data;this.removeFirst();return a},peek:function(){return this.firstnode.data}});
ds.data.tree=ds.make["class"]({type:"Tree","implements":ds.interfaces.enumerable,inherits:ds.data.enumerable,constructor:function(a){this.root=a;this.leaf=[];var b=0,c=this.leaf;ds.forx(a,function(a,d,g,k){a.parent=g;(a.isLeaf=k)&&c.push(a);b++},!1);this.length=b;a=Object.keys(this.root);for(var d=0;d<a.length;d++)if(ds.type,ds.isArray(this.root[a[d]])){this.recurseOn=a[d];break}},toArray:function(){var a=[];ds.forx(this.root,function(b){a.push(b)},this.recurseOn);return a},iterate:function(a){ds.forx(this.root,
a,this.recurseOn)}});
